# September 2025 Changelog

## 2025-09-08: API Versioning Consistency Fix

### Problem Identified
- **API Version Mismatch**: The validate endpoint was using the non-versioned API (`/api/n8n/validate`) while the calculate endpoint was using the v1 API (`/api/n8n/v1/calculate`)
- **Inconsistent Response Structure**: v1 API returns `response.data.article` format while non-versioned API returns direct response fields
- **n8n Workflow Errors**: Version mismatch caused validation failures and incorrect response parsing in n8n workflows

### Root Cause Analysis
The `nodes/CalcsLive/helpers/apiClient.ts` file was making requests to:
- ❌ **Incorrect**: `${baseUrl}/api/n8n/validate?articleId=${articleId}&apiKey=${credentials.apiKey}`
- ✅ **Correct**: `${baseUrl}/api/n8n/v1/validate?articleId=${articleId}&apiKey=${credentials.apiKey}`

### Solution Implemented

#### File Modified: `nodes/CalcsLive/helpers/apiClient.ts`
**Line 25**: Updated API endpoint URL construction
```typescript
// BEFORE (inconsistent):
const requestUrl = `${baseUrl}/api/n8n/validate?articleId=${articleId}&apiKey=${credentials.apiKey}`;

// AFTER (consistent v1 API):
const requestUrl = `${baseUrl}/api/n8n/v1/validate?articleId=${articleId}&apiKey=${credentials.apiKey}`;
```

#### Response Structure Handling (Already Correct)
**Lines 48-50**: The response parsing was already correctly handling the v1 API structure:
```typescript
if (response.success && response.data?.article) {
    const apiData = response.data.article; // v1 API structure
    // ... rest of processing
}
```

### Technical Impact

#### **Eliminated Version Mismatch Errors**
- Both calculate and validate endpoints now use consistent v1 API versioning
- Unified response structure across all CalcsLive API endpoints
- Improved reliability for n8n workflow integrations

#### **Enhanced Error Handling**
- Consistent error response formats between endpoints
- Better debugging capabilities with aligned API responses
- Reduced confusion from mixed API version behaviors

#### **Improved Developer Experience**  
- Single API version to document and maintain
- Consistent authentication and response patterns
- Simplified troubleshooting for integration issues

### Verification Steps
1. **API Consistency**: Both `/api/n8n/v1/calculate` and `/api/n8n/v1/validate` now use identical versioning
2. **Response Structure**: All responses follow `{success: boolean, data: {...}}` format
3. **n8n Integration**: Node validation and calculation work seamlessly together
4. **Error Handling**: Consistent error responses across all CalcsLive endpoints

### Files Changed
- ✅ `nodes/CalcsLive/helpers/apiClient.ts` (Line 25): API endpoint URL updated to v1

### Next Steps
- Monitor n8n workflows for improved reliability
- Consider adding version detection for automatic API migration
- Document API versioning strategy for future endpoint changes

---

**Impact**: Critical bug fix that eliminates API version inconsistency errors in n8n workflows and ensures reliable CalcsLive integration.